(self.webpackChunkBornforthi_notebook=self.webpackChunkBornforthi_notebook||[]).push([["prosemirror"],{"./src/components/editor/prosemirror/module.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{EditorState:()=>r.yy,EditorView:()=>s.tk,Plugin:()=>r.Sy,createProseMirrorEditor:()=>ct,defaultMarkdownSerializer:()=>rt});var s=n("./node_modules/prosemirror-view/dist/index.es.js"),r=n("./node_modules/prosemirror-state/dist/index.es.js"),o=n("./node_modules/@github/mini-throttle/dist/index.js"),i=n("./node_modules/prosemirror-keymap/dist/index.es.js"),a=n("./node_modules/prosemirror-history/dist/index.es.js"),l=n("./node_modules/prosemirror-commands/dist/index.es.js"),c=n("./node_modules/prosemirror-dropcursor/dist/index.es.js"),d=n("./node_modules/prosemirror-gapcursor/dist/index.es.js"),h=n("./node_modules/prosemirror-menu/dist/index.es.js"),u=n("./node_modules/prosemirror-schema-list/dist/index.es.js");const p="ProseMirror-prompt";function m(t){const e=document.body.appendChild(document.createElement("div"));e.className=p;const n=t=>{e.contains(t.target)||s()};setTimeout((()=>window.addEventListener("mousedown",n)),50);const s=()=>{window.removeEventListener("mousedown",n),e.parentNode&&e.parentNode.removeChild(e)},r=[];for(const e in t.fields)r.push(t.fields[e].render());const o=document.createElement("button");o.type="submit",o.className=p+"-submit",o.textContent="OK";const i=document.createElement("button");i.type="button",i.className=p+"-cancel",i.textContent="Cancel",i.addEventListener("click",s);const a=e.appendChild(document.createElement("form"));t.title&&(a.appendChild(document.createElement("h5")).textContent=t.title),r.forEach((t=>{a.appendChild(document.createElement("div")).appendChild(t)}));const l=a.appendChild(document.createElement("div"));l.className=p+"-buttons",l.appendChild(o),l.appendChild(document.createTextNode(" ")),l.appendChild(i);const c=e.getBoundingClientRect();e.style.top=(window.innerHeight-c.height)/2+"px",e.style.left=(window.innerWidth-c.width)/2+"px";const d=()=>{const e=function(t,e){let n=Object.create(null),s=0;for(const r in t){const o=t[r],i=e[s++],a=o.read(i),l=o.validate(a);if(l)return g(i,l),null;n[r]=o.clean(a)}return n}(t.fields,r);e&&(s(),t.callback(e))};a.addEventListener("submit",(t=>{t.preventDefault(),d()})),a.addEventListener("keydown",(t=>{27==t.keyCode?(t.preventDefault(),s()):13!=t.keyCode||t.ctrlKey||t.metaKey||t.shiftKey?9==t.keyCode&&window.setTimeout((()=>{e.contains(document.activeElement)||s()}),500):(t.preventDefault(),d())}));const h=a.elements[0];h&&h.focus()}function g(t,e){const n=t.parentNode,s=n.appendChild(document.createElement("div"));s.style.left=t.offsetLeft+t.offsetWidth+2+"px",s.style.top=t.offsetTop-5+"px",s.className="ProseMirror-invalid",s.textContent=e,setTimeout((()=>n.removeChild(s)),1500)}class f extends class{constructor(t){this.options=t}read(t){return t.value}validateType(t){}validate(t){return!t&&this.options.required?"Required field":this.validateType(t)||this.options.validate&&this.options.validate(t)}clean(t){return this.options.clean?this.options.clean(t):t}}{render(){const t=document.createElement("input");return t.type="text",t.placeholder=this.options.label,t.value=this.options.value||"",t.autocomplete="off",t}}function k(t,e){const n=t.selection.$from;for(let t=n.depth;t>=0;t--){const s=n.index(t);if(n.node(t).canReplaceWith(s,s,e))return!0}return!1}function _(t,e){const n={label:e.title,run:t};for(const t in e)n[t]=e[t];return e.enable&&!0!==e.enable||e.select||(n[e.enable?"enable":"select"]=e=>t(e)),new h.sN(n)}function w(t,e){const{from:n,$from:s,to:r,empty:o}=t.selection;return o?e.isInSet(t.storedMarks||s.marks()):t.doc.rangeHasMark(n,r,e)}function b(t,e){const n={active:e=>w(e,t),enable:!0};for(const t in e)n[t]=e[t];return _((0,l.w9)(t),n)}function x(t,e){return _((0,u.KI)(t,e.attrs),e)}function y(t){const e={};let n;var s,o;if((n=t.marks.strong)&&(e.toggleStrong=b(n,{title:"Toggle strong style",icon:h.ci.strong})),(n=t.marks.em)&&(e.toggleEm=b(n,{title:"Toggle emphasis",icon:h.ci.em})),(n=t.marks.code)&&(e.toggleCode=b(n,{title:"Toggle code font",icon:h.ci.code})),(n=t.marks.link)&&(e.toggleLink=(s=n,new h.sN({title:"Add or remove link",icon:h.ci.link,active:t=>w(t,s),enable:t=>!t.selection.empty,run(t,e,n){if(w(t,s))return(0,l.w9)(s)(t,e),!0;m({title:"Create a link",fields:{href:new f({label:"Link target",required:!0}),title:new f({label:"Title"})},callback(t){(0,l.w9)(s,t)(n.state,n.dispatch),n.focus()}})}}))),(n=t.nodes.image)&&(e.insertImage=(o=n,new h.sN({title:"Insert image",label:"Image",enable:t=>k(t,o),run(t,e,n){const{from:s,to:i}=t.selection;let a=null;t.selection instanceof r.qv&&t.selection.node.type==o&&(a=t.selection.node.attrs),m({title:"Insert image",fields:{src:new f({label:"Location",required:!0,value:a&&a.src}),title:new f({label:"Title",value:a&&a.title}),alt:new f({label:"Description",value:a?a.alt:t.doc.textBetween(s,i," ")})},callback(t){n.dispatch(n.state.tr.replaceSelectionWith(o.createAndFill(t))),n.focus()}})}}))),(n=t.nodes.bullet_list)&&(e.wrapBulletList=x(n,{title:"Wrap in bullet list",icon:h.ci.bulletList})),(n=t.nodes.ordered_list)&&(e.wrapOrderedList=x(n,{title:"Wrap in ordered list",icon:h.ci.orderedList})),(n=t.nodes.blockquote)&&(e.wrapBlockQuote=(0,h.lB)(n,{title:"Wrap in block quote",icon:h.ci.blockquote})),(n=t.nodes.paragraph)&&(e.makeParagraph=(0,h.Gl)(n,{title:"Change to paragraph",label:"Plain"})),(n=t.nodes.code_block)&&(e.makeCodeBlock=(0,h.Gl)(n,{title:"Change to code block",label:"Code"})),n=t.nodes.heading)for(let t=1;t<=10;t++)e["makeHead"+t]=(0,h.Gl)(n,{title:"Change to heading "+t,label:"Level "+t,attrs:{level:t}});if(n=t.nodes.horizontal_rule){const t=n;e.insertHorizontalRule=new h.sN({title:"Insert horizontal rule",label:"Horizontal rule",enable:e=>k(e,t),run(e,n){n(e.tr.replaceSelectionWith(t.create()))}})}const i=t=>t.filter((t=>t));return e.insertMenu=new h.Lt(i([e.insertImage,e.insertHorizontalRule]),{label:"Insert"}),e.typeMenu=new h.Lt(i([e.makeParagraph,e.makeCodeBlock,e.makeHead1&&new h.Yz(i([e.makeHead1,e.makeHead2,e.makeHead3,e.makeHead4,e.makeHead5,e.makeHead6]),{label:"Heading"})]),{label:"Type..."}),e.inlineMenu=[i([e.toggleStrong,e.toggleEm,e.toggleCode,e.toggleLink])],e.blockMenu=[i([e.wrapBulletList,e.wrapOrderedList,e.wrapBlockQuote,h.jN,h.VX,h.tb])],e.fullMenu=e.inlineMenu.concat([[e.insertMenu,e.typeMenu]],[[h.dY,h.gn]],e.blockMenu),e}var M=n("./node_modules/prosemirror-inputrules/dist/index.es.js");const v="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function E(t,e){const n={};let s;function r(t,s){if(e){const n=e[t];if(!1===n)return;n&&(t=n)}n[t]=s}if(r("Mod-z",a.Yw),r("Shift-Mod-z",a.KX),r("Backspace",M.dU),v||r("Mod-y",a.KX),r("Alt-ArrowUp",l.MI),r("Alt-ArrowDown",l.Ig),r("Mod-BracketLeft",l.xb),r("Escape",l.N0),(s=t.marks.strong)&&(r("Mod-b",(0,l.w9)(s)),r("Mod-B",(0,l.w9)(s))),(s=t.marks.em)&&(r("Mod-i",(0,l.w9)(s)),r("Mod-I",(0,l.w9)(s))),(s=t.marks.code)&&r("Mod-`",(0,l.w9)(s)),(s=t.nodes.bullet_list)&&r("Shift-Ctrl-8",(0,u.KI)(s)),(s=t.nodes.ordered_list)&&r("Shift-Ctrl-9",(0,u.KI)(s)),(s=t.nodes.blockquote)&&r("Ctrl->",(0,l.ym)(s)),s=t.nodes.hard_break){const t=s,e=(0,l.QF)(l.uo,((e,n)=>(n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0)));r("Mod-Enter",e),r("Shift-Enter",e),v&&r("Ctrl-Enter",e)}if((s=t.nodes.list_item)&&(r("Enter",(0,u.s6)(s)),r("Mod-[",(0,u.IB)(s)),r("Mod-]",(0,u.bw)(s))),(s=t.nodes.paragraph)&&r("Shift-Ctrl-0",(0,l.uJ)(s)),(s=t.nodes.code_block)&&r("Shift-Ctrl-\\",(0,l.uJ)(s)),s=t.nodes.heading)for(let t=1;t<=6;t++)r("Shift-Ctrl-"+t,(0,l.uJ)(s,{level:t}));if(s=t.nodes.horizontal_rule){const t=s;r("Mod-_",((e,n)=>(n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0)))}return n}function C(t){const e=M.yR.concat(M.LH,M.pR);let n;var s;return(n=t.nodes.blockquote)&&e.push((s=n,(0,M.S0)(/^\s*>\s$/,s))),(n=t.nodes.ordered_list)&&e.push(function(t){return(0,M.S0)(/^(\d+)\.\s$/,t,(t=>({order:+t[1]})),((t,e)=>e.childCount+e.attrs.order==+t[1]))}(n)),(n=t.nodes.bullet_list)&&e.push(function(t){return(0,M.S0)(/^\s*([-+*])\s$/,t)}(n)),(n=t.nodes.code_block)&&e.push(function(t){return(0,M.zK)(/^```$/,t)}(n)),(n=t.nodes.heading)&&e.push(function(t,e){return(0,M.zK)(new RegExp("^(#{1,6})\\s$"),t,(t=>({level:t[1].length})))}(n)),(0,M.Hw)({rules:e})}var S=n("./node_modules/@benrbray/prosemirror-math/dist/index.es.js"),O=n("./src/components/helpers/katex.ts"),T=n("./node_modules/prosemirror-transform/dist/index.es.js");function L(t,e,n,s=!0){return(o,i)=>{const a=t.state,{to:l,from:c}=a.selection,{to:d,from:h}=o.selection;if(s&&d!==h)return!1;const u=e>0?d:h;if(n){const t=o.doc.nodeSize-2;if(e>0&&u<t)return!1;if(e<0&&u>0)return!1}if(i){const n=e>0?l:c;t.dispatch(a.tr.setSelection(r.Bs.create(a.doc,n))),t.focus()}return!0}}var V=n("./node_modules/katex/dist/katex.js");const D=(0,O.Qj)();class A{constructor(t,e,n,s={},r,o){this._node=t,this._outerView=e,this._getPos=n,this._onDestroy=o&&o.bind(this),this._mathPluginKey=r,this.cursorSide="start",this._isEditing=!1,this._katexOptions=Object.assign({globalGroup:!0,throwOnError:!1},s.katexOptions),this._tagName=s.tagName||this._node.type.name.replace("_","-"),this.dom=document.createElement(this._tagName),this.dom.classList.add("math-node"),this._mathRenderElt=document.createElement("span"),this._mathRenderElt.textContent="",this._mathRenderElt.classList.add("math-render"),this.dom.appendChild(this._mathRenderElt),this._mathSrcElt=document.createElement("span"),this._mathSrcElt.classList.add("math-src"),this.dom.appendChild(this._mathSrcElt),this.dom.addEventListener("click",(()=>this.ensureFocus())),this.renderMath()}destroy(){this.closeEditor(!1),this._mathRenderElt&&(this._mathRenderElt.remove(),delete this._mathRenderElt),this._mathSrcElt&&(this._mathSrcElt.remove(),delete this._mathSrcElt),this.dom.remove()}ensureFocus(){this._innerView&&this._outerView.hasFocus()&&this._innerView.focus()}update(t,e){if(!t.sameMarkup(this._node))return!1;if(this._node=t,this._innerView){const e=this._innerView.state,n=t.content.findDiffStart(e.doc.content);if(null!=n){const s=t.content.findDiffEnd(e.doc.content);if(s){let{a:r,b:o}=s;const i=n-Math.min(r,o);i>0&&(r+=i,o+=i),this._innerView.dispatch(e.tr.replace(n,o,t.slice(n,r)).setMeta("fromOutside",!0))}}}return this._isEditing||this.renderMath(),!0}updateCursorPos(t){const e=this._getPos(),n=this._node.nodeSize;t.selection.from<e+n&&e<t.selection.to||(this.cursorSide=e<t.selection.from?"end":"start")}selectNode(){this.dom.classList.add("ProseMirror-selectednode"),this._isEditing||this.openEditor()}deselectNode(){this.dom.classList.remove("ProseMirror-selectednode"),this._isEditing&&this.closeEditor()}stopEvent(t){return void 0!==this._innerView&&void 0!==t.target&&this._innerView.dom.contains(t.target)}ignoreMutation(){return!0}renderMath(){if(!this._mathRenderElt)return;const t=this._node.content.content;let e="";if(t.length>0&&null!==t[0].textContent&&(e=t[0].textContent.trim()),e.length<1)for(this.dom.classList.add("empty-math");this._mathRenderElt.firstChild;)this._mathRenderElt.firstChild.remove();else this.dom.classList.remove("empty-math"),D.then((t=>{if(this._mathRenderElt)try{t.render(e,this._mathRenderElt,this._katexOptions),this._mathRenderElt.classList.remove("parse-error"),this.dom.setAttribute("title","")}catch(t){if(!(t instanceof V.ParseError))throw t;console.error(t),this._mathRenderElt.classList.add("parse-error"),this.dom.setAttribute("title",t.toString())}}))}dispatchInner(t){if(!this._innerView)return;const{state:e,transactions:n}=this._innerView.state.applyTransaction(t);if(this._innerView.updateState(e),!t.getMeta("fromOutside")){const t=this._outerView.state.tr,e=T.KS.offset(this._getPos()+1);for(let s=0;s<n.length;s++){const r=n[s].steps;for(let n=0;n<r.length;n++){const s=r[n].map(e);if(!s)throw Error("step discarded!");t.step(s)}}t.docChanged&&this._outerView.dispatch(t)}}openEditor(){if(this._innerView)throw Error("inner view should not exist!");this._innerView=new s.tk(this._mathSrcElt,{state:r.yy.create({doc:this._node,plugins:[(0,i.h)({Tab:(t,e)=>(e&&e(t.tr.insertText("\t")),!0),Backspace:(0,l.QF)(l.NE,((t,e,n)=>!(!t.selection.empty||this._node.textContent.length>0||(this._outerView.dispatch(this._outerView.state.tr.insertText("")),this._outerView.focus(),0)))),"Ctrl-Backspace":(t,e,n)=>(this._outerView.dispatch(this._outerView.state.tr.insertText("")),this._outerView.focus(),!0),Enter:(0,l.QF)(l.QK,L(this._outerView,1,!1)),"Ctrl-Enter":L(this._outerView,1,!1),ArrowLeft:L(this._outerView,-1,!0),ArrowRight:L(this._outerView,1,!0),ArrowUp:L(this._outerView,-1,!0),ArrowDown:L(this._outerView,1,!0)})]}),dispatchTransaction:this.dispatchInner.bind(this)});const t=this._innerView.state;this._innerView.focus();const e=this._mathPluginKey.getState(this._outerView.state),n=e&&e.prevCursorPos;null==n&&console.error("[prosemirror-math] Error:  Unable to fetch math plugin state from key.");const o=(n||0)<=this._getPos()?0:this._node.nodeSize-2;this._innerView.dispatch(t.tr.setSelection(r.Bs.create(t.doc,o))),this._isEditing=!0}closeEditor(t=!0){if(this._innerView){try{this._innerView.destroy()}catch(t){}this._innerView=void 0}t&&this.renderMath(),this._isEditing=!1}}const N=new r.H$("prosemirror-math");function $(t){return(e,n,s)=>{const r=N.getState(n.state);if(!r)throw new Error("no math plugin!");const o=r.activeNodeViews,i=new A(e,n,s,{katexOptions:{displayMode:t,macros:r.macros}},N,(()=>{o.splice(o.indexOf(i))}));return o.push(i),i}}const B={key:N,state:{init:(t,e)=>({macros:{},activeNodeViews:[],prevCursorPos:0}),apply:(t,e,n,s)=>({activeNodeViews:e.activeNodeViews,macros:e.macros,prevCursorPos:n.selection.from})},props:{nodeViews:{math_inline:$(!1),math_display:$(!0)}}},I=new r.Sy(B);function R(t){const e=(0,S.Oi)(S._V,t.nodes.math_inline),n=(0,S.Yx)(S.O6,t.nodes.math_display);return[I,(0,i.h)({"Mod-Space":(0,S.$O)(t.nodes.math_inline),Backspace:(0,l.QF)(l.NE,S.Ly,l.al,l._M)}),(0,M.Hw)({rules:[e,n]})]}function q(t){const e=[C(t.schema),(0,i.h)(E(t.schema,t.mapKeys)),(0,i.h)(l.YR),(0,c.q)(),(0,d.d)(),...R(t.schema)];return!1!==t.menuBar&&e.push((0,h.hn)({floating:!1!==t.floatingMenu,content:t.menuContent||y(t.schema).fullMenu})),e.push((0,a.m8)()),e.concat(new r.Sy({props:{attributes:{class:"ProseMirror-example-setup-style"}}}))}const z={nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},blockquote:{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["div",["hr"]]},heading:{attrs:{level:{default:1}},content:"(text | image)*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:t=>["h"+t.attrs.level,0]},code_block:{content:"text*",group:"block",code:!0,defining:!0,marks:"",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:t=>({params:node.getAttribute("data-params")||""})}],toDOM:t=>["pre",t.attrs.params?{"data-params":t.attrs.params}:{},["code",0]]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1},tight:{default:!1}},parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?+t.getAttribute("start"):1,tight:t.hasAttribute("data-tight")})}],toDOM:t=>["ol",{start:1==t.attrs.order?null:t.attrs.order,"data-tight":t.attrs.tight?"true":null},0]},bullet_list:{content:"list_item+",group:"block",attrs:{tight:{default:!1}},parseDOM:[{tag:"ul",getAttrs:t=>({tight:t.hasAttribute("data-tight")})}],toDOM:t=>["ul",{"data-tight":t.attrs.tight?"true":null},0]},list_item:{content:"paragraph block*",defining:!0,parseDOM:[{tag:"li"}],toDOM:()=>["li",0]},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:t=>({src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")})}],toDOM:t=>["img",t.attrs]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]}},marks:{em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:t=>"italic"==t&&null}],toDOM:()=>["em"]},strong:{parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM:()=>["strong"]},link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),title:t.getAttribute("title")})}],toDOM:t=>["a",t.attrs]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code"]}}};var H=n("./node_modules/prosemirror-model/dist/index.es.js"),j=n("./node_modules/markdown-it/index.js"),P=n.n(j);function K(t,e){let n,s,r=t.posMax,o=!0,i=!0;return n=e>0?t.src.charCodeAt(e-1):-1,s=e+1<=r?t.src.charCodeAt(e+1):-1,(32===n||9===n||s>=48&&s<=57)&&(i=!1),32!==s&&9!==s||(o=!1),{can_open:o,can_close:i}}function W(t,e){let n,s,r,o,i;if("$"!==t.src[t.pos])return!1;if(o=K(t,t.pos),!o.can_open)return e||(t.pending+="$"),t.pos+=1,!0;for(n=t.pos+1,s=n;-1!==(s=t.src.indexOf("$",s));){for(i=s-1;"\\"===t.src[i];)i-=1;if((s-i)%2==1)break;s+=1}return-1===s?(e||(t.pending+="$"),t.pos=n,!0):s-n==0?(e||(t.pending+="$$"),t.pos=n+1,!0):(o=K(t,s),o.can_close?(e||(r=t.push("math_inline","math",0),r.markup="$",r.content=t.src.slice(n,s)),t.pos=s+1,!0):(e||(t.pending+="$"),t.pos=n,!0))}function F(t,e,n,s){let r,o,i,a,l,c=!1,d=t.bMarks[e]+t.tShift[e],h=t.eMarks[e];if(d+2>h)return!1;if("$$"!==t.src.slice(d,d+2))return!1;if(d+=2,r=t.src.slice(d,h),s)return!0;for("$$"===r.trim().slice(-2)&&(r=r.trim().slice(0,-2),c=!0),i=e;!(c||(i++,i>=n)||(d=t.bMarks[i]+t.tShift[i],h=t.eMarks[i],d<h&&t.tShift[i]<t.blkIndent));)"$$"===t.src.slice(d,h).trim().slice(-2)&&(a=t.src.slice(0,h).lastIndexOf("$$"),o=t.src.slice(d,a),c=!0);return t.line=i+1,l=t.push("math_display","math",0),l.block=!0,l.content=(r&&r.trim()?r+"\n":"")+t.getLines(e+1,i,t.tShift[e],!0)+(o&&o.trim()?o:""),l.map=[e,t.line],l.markup="$$",!0}function G(t){t.inline.ruler.after("escape","math_inline",W),t.block.ruler.after("blockquote","math_display",F,{alt:["paragraph","reference","blockquote","list"]})}class Q{constructor(t,e){this.schema=t,this.stack=[{type:t.topNodeType,content:[]}],this.marks=H.vc.none,this.tokenHandlers=e}top(){return this.stack[this.stack.length-1]}push(t){this.stack.length&&this.top().content.push(t)}addText(t){if(!t)return;const e=this.top().content,n=e[e.length-1],s=this.schema.text(t,this.marks);let r;n&&(r=function(t,e){if(t.isText&&e.isText&&H.vc.sameSet(t.marks,e.marks))return t.withText(t.text+e.text)}(n,s))?e[e.length-1]=r:e.push(s)}openMark(t){this.marks=t.addToSet(this.marks)}closeMark(t){this.marks=t.removeFromSet(this.marks)}parseTokens(t){for(let e=0;e<t.length;e++){const n=t[e],s=this.tokenHandlers[n.type];if(!s)throw new Error("Token type `"+n.type+"` not supported by Markdown parser");s(this,n,t,e)}}addNode(t,e,n){const s=t.createAndFill(e,n,this.marks);return s?(this.push(s),s):null}openNode(t,e){this.stack.push({type:t,attrs:e,content:[]})}closeNode(){this.marks.length&&(this.marks=H.vc.none);const t=this.stack.pop();return this.addNode(t.type,t.attrs,t.content)}}function U(t,e,n,s){return t.getAttrs?t.getAttrs(e,n,s):t.attrs instanceof Function?t.attrs(e):t.attrs}function Y(t,e){return t.noCloseToken||"code_inline"==e||"code_block"==e||"fence"==e}function J(t){return"\n"==t[t.length-1]?t.slice(0,t.length-1):t}function X(){}class Z{constructor(t,e,n){this.tokens=n,this.schema=t,this.tokenizer=e,this.tokenHandlers=function(t,e){const n=Object.create(null);for(const s in e){const r=e[s];if(r.block){const e=t.nodeType(r.block);Y(r,s)?n[s]=(t,n,s,o)=>{t.openNode(e,U(r,n,s,o)),t.addText(J(n.content)),t.closeNode()}:(n[s+"_open"]=(t,n,s,o)=>t.openNode(e,U(r,n,s,o)),n[s+"_close"]=t=>t.closeNode())}else if(r.node){const e=t.nodeType(r.node);n[s]=(t,n,s,o)=>t.addNode(e,U(r,n,s,o))}else if(r.mark){const e=t.marks[r.mark];Y(r,s)?n[s]=(t,n,s,o)=>{t.openMark(e.create(U(r,n,s,o))),t.addText(J(n.content)),t.closeMark(e)}:(n[s+"_open"]=(t,n,s,o)=>t.openMark(e.create(U(r,n,s,o))),n[s+"_close"]=t=>t.closeMark(e))}else{if(!r.ignore)throw new RangeError("Unrecognized parsing spec "+JSON.stringify(r));Y(r,s)?n[s]=X:(n[s+"_open"]=X,n[s+"_close"]=X)}}return n.text=(t,e)=>t.addText(e.content),n.inline=(t,e)=>t.parseTokens(e.children),n.softbreak=n.softbreak||(t=>t.addText("\n")),n}(t,n)}parse(t){const e=new Q(this.schema,this.tokenHandlers);let n;e.parseTokens(this.tokenizer.parse(t,{}));do{n=e.closeNode()}while(e.stack.length);return n}}function tt(t,e){for(;++e<t.length;)if("list_item_open"!=t[e].type)return t[e].hidden;return!1}class et{constructor(t,e,n){this.nodes=t,this.marks=e,this.delim=this.out="",this.closed=!1,this.inTightList=!1,this.options=n||{},void 0===this.options.tightLists&&(this.options.tightLists=!1)}flushClose(t){if(this.closed){if(this.atBlank()||(this.out+="\n"),null==t&&(t=2),t>1){let e=this.delim;const n=/\s+$/.exec(e);n&&(e=e.slice(0,e.length-n[0].length));for(let n=1;n<t;n++)this.out+=e+"\n"}this.closed=!1}}wrapBlock(t,e,n,s){const r=this.delim;this.write(e||t),this.delim+=t,s(),this.delim=r,this.closeBlock(n)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){this.atBlank()||(this.out+="\n")}write(t){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),t&&(this.out+=t)}closeBlock(t){this.closed=t}text(t,e){const n=t.split("\n");for(let t=0;t<n.length;t++){const s=this.atBlank()||this.closed;this.write(),this.out+=!1!==e?this.esc(n[t],!!s):n[t],t!=n.length-1&&(this.out+="\n")}}render(t,e,n){if("number"==typeof e)throw new Error("!");if(!this.nodes[t.type.name])throw new Error("Token type `"+t.type.name+"` not supported by Markdown renderer");this.nodes[t.type.name](this,t,e,n)}renderContent(t){t.forEach(((e,n,s)=>this.render(e,t,s)))}renderInline(t){const e=[];let n="";const s=(s,r,o)=>{let i=s?s.marks:[];s&&"hard_break"===s.type.name&&(i=i.filter((e=>{if(o+1==t.childCount)return!1;const n=t.child(o+1);return e.isInSet(n.marks)&&(!n.isText||/\S/.test(n.text))})));let a=n;if(n="",s&&s.isText&&i.some((t=>{const e=this.marks[t.type.name];return e&&e.expelEnclosingWhitespace}))){const[t,r,o,l]=/^(\s*)(.*?)(\s*)$/m.exec(s.text);a+=r,n=l,(r||l)&&((s=o?s.withText(o):null)||(i=e))}const l=i.length&&i[i.length-1],c=l&&!1===this.marks[l.type.name].escape,d=i.length-(c?1:0);t:for(let t=0;t<d;t++){const n=i[t];if(!this.marks[n.type.name].mixable)break;for(let s=0;s<e.length;s++){const r=e[s];if(!this.marks[r.type.name].mixable)break;if(n.eq(r)){t>s?i=i.slice(0,s).concat(n).concat(i.slice(s,t)).concat(i.slice(t+1,d)):s>t&&(i=i.slice(0,t).concat(i.slice(t+1,s)).concat(n).concat(i.slice(s,d)));continue t}}}let h=0;for(;h<Math.min(e.length,d)&&i[h].eq(e[h]);)++h;for(;h<e.length;)this.text(this.markString(e.pop(),!1,t,o),!1);if(a&&this.text(a),s){for(;e.length<d;){const n=i[e.length];e.push(n),this.text(this.markString(n,!0,t,o),!1)}c&&s.isText?this.text(this.markString(l,!0,t,o)+s.text+this.markString(l,!1,t,o+1),!1):this.render(s,t,o)}};t.forEach(s),s(null,0,t.childCount)}renderList(t,e,n){this.closed&&this.closed.type==t.type?this.flushClose(3):this.inTightList&&this.flushClose(1);const s=void 0!==t.attrs.tight?t.attrs.tight:this.options.tightLists,r=this.inTightList;this.inTightList=s,t.forEach(((r,o,i)=>{i&&s&&this.flushClose(1),this.wrapBlock(e,n(i),t,(()=>this.render(r,t,i)))})),this.inTightList=r}esc(t,e){return t=t.replace(/[`*\\~\[\]]/g,"\\$&"),e&&(t=t.replace(/^[:#\-*+]/,"\\$&").replace(/^(\s*\d+)\./,"$1\\.")),t}quote(t){const e=-1==t.indexOf('"')?'""':-1==t.indexOf("'")?"''":"()";return e[0]+t+e[1]}repeat(t,e){let n="";for(let s=0;s<e;s++)n+=t;return n}markString(t,e,n,s){const r=this.marks[t.type.name],o=e?r.open:r.close;return"string"==typeof o?o:o(this,t,n,s)}getEnclosingWhitespace(t){return{leading:(t.match(/^(\s+)/)||[])[0],trailing:(t.match(/(\s+)$/)||[])[0]}}}function nt(t,e){const n=/`+/g;let s,r=0;if(t.isText)for(;s=n.exec(t.text);)r=Math.max(r,s[0].length);let o=r>0&&e>0?" `":"`";for(let t=0;t<r;t++)o+="`";return r>0&&e<0&&(o+=" "),o}function st(t,e,n,s){if(t.attrs.title||!/^\w+:/.test(t.attrs.href))return!1;const r=e.child(n+(s<0?-1:0));if(!r.isText||r.text!=t.attrs.href||r.marks[r.marks.length-1]!=t)return!1;if(n==(s<0?1:e.childCount-1))return!0;const o=e.child(n+(s<0?-2:1));return!t.isInSet(o.marks)}const rt=new class{constructor(t,e){this.nodes=t,this.marks=e}serialize(t,e){const n=new et(this.nodes,this.marks,e);return n.renderContent(t),n.out}}({blockquote(t,e){t.wrapBlock("> ",null,e,(()=>t.renderContent(e)))},code_block(t,e){t.write("```"+(e.attrs.params||"")+"\n"),t.text(e.textContent,!1),t.ensureNewLine(),t.write("```"),t.closeBlock(e)},heading(t,e){t.write(t.repeat("#",e.attrs.level)+" "),t.renderInline(e),t.closeBlock(e)},horizontal_rule(t,e){t.write(e.attrs.markup||"---"),t.closeBlock(e)},bullet_list(t,e){t.renderList(e,"  ",(()=>(e.attrs.bullet||"*")+" "))},ordered_list(t,e){const n=e.attrs.order||1,s=String(n+e.childCount-1).length,r=t.repeat(" ",s+2);t.renderList(e,r,(e=>{const r=String(n+e);return t.repeat(" ",s-r.length)+r+". "}))},list_item(t,e){t.renderContent(e)},math_inline(t,e){t.write("$"+e.textContent+"$")},math_display(t,e){t.write("$$\n"),t.text(e.textContent,!1),t.ensureNewLine(),t.write("$$"),t.closeBlock(e)},paragraph(t,e){t.renderInline(e),t.closeBlock(e)},image(t,e){t.write("!["+t.esc(e.attrs.alt||"")+"]("+t.esc(e.attrs.src)+(e.attrs.title?" "+t.quote(e.attrs.title):"")+")")},hard_break(t,e,n,s){for(let r=s+1;r<n.childCount;r++)if(n.child(r).type!=e.type)return void t.write("\\\n")},text(t,e){t.text(e.text)}},{em:{open:"*",close:"*",mixable:!0,expelEnclosingWhitespace:!0},strong:{open:"**",close:"**",mixable:!0,expelEnclosingWhitespace:!0},link:{open:(t,e,n,s)=>st(e,n,s,1)?"<":"[",close:(t,e,n,s)=>st(e,n,s,-1)?">":"]("+t.esc(e.attrs.href)+(e.attrs.title?" "+t.quote(e.attrs.title):"")+")"},code:{open:(t,e,n,s)=>nt(n.child(s),-1),close:(t,e,n,s)=>nt(n.child(s-1),1),escape:!1}}),ot=new H.V_({nodes:{...(it=z).nodes,...(at={nodes:{math_inline:{group:"inline math",content:"text*",inline:!0,atom:!0,toDOM:()=>["math-inline",{class:"math-node"},0],parseDOM:[{tag:"math-inline"}]},math_display:{group:"block math",content:"text*",atom:!0,code:!0,toDOM:()=>["math-display",{class:"math-node"},0],parseDOM:[{tag:"math-display"}]}}}).nodes},marks:{...it.marks,...at.marks}});var it,at;const lt=function(t){const e=P()("commonmark",{html:!1});return e.use(G),new Z(t,e,{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item"},bullet_list:{block:"bullet_list",getAttrs:(t,e,n)=>({tight:tt(e,n)})},ordered_list:{block:"ordered_list",getAttrs:(t,e,n)=>({order:+t.attrGet("start")||1,tight:tt(e,n)})},heading:{block:"heading",getAttrs:t=>({level:+t.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:t=>({params:t.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:t=>({src:t.attrGet("src"),title:t.attrGet("title")||null,alt:t.children[0]&&t.children[0].content||null})},hardbreak:{node:"hard_break"},math_inline:{block:"math_inline",noCloseToken:!0},math_display:{block:"math_display",noCloseToken:!0},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:t=>({href:t.attrGet("href"),title:t.attrGet("title")||null})},code_inline:{mark:"code",noCloseToken:!0}})}(ot);function ct(t,e,n){return new s.tk(t,{state:r.yy.create({doc:lt.parse(e.textContent),plugins:[(0,i.h)({ArrowDown:function(t,e,n){return t.selection.empty,!1},ArrowUp:function(t,e,n){return t.selection.empty,!1}}),...q({schema:ot}),new r.Sy({view:()=>({update:(0,o.D)((t=>{e.textContent=rt.serialize(t.state.doc)}),50)})})]})})}}}]);